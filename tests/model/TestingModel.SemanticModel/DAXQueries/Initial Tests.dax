DEFINE

// ============================================
// DAX Assertion Library Test Suite
// Tests all assertion functions with various permutations
// ============================================

// Test data setup
VAR _TestTableWithRows = DATATABLE("Col1", STRING, "Col2", INTEGER, {{"A", 1}, {"B", 2}, {"C", 3}})
VAR _EmptyTable = FILTER(_TestTableWithRows, FALSE)

// ============================================
// PQL.Assert.ShouldBeTrue Tests
// ============================================
VAR _AssertTrue_Pass = PQL.Assert.ShouldBeTrue("ShouldBeTrue: TRUE condition should pass", TRUE)
VAR _AssertTrue_Fail = PQL.Assert.ShouldBeTrue("ShouldBeTrue: FALSE condition should fail", FALSE)
VAR _AssertTrue_Expression = PQL.Assert.ShouldBeTrue("ShouldBeTrue: Expression 1=1 should pass", 1 = 1)
VAR _AssertTrue_ComplexExpr = PQL.Assert.ShouldBeTrue("ShouldBeTrue: Complex expression should pass", 5 > 3 && 10 < 20)

// ============================================
// PQL.Assert.ShouldBeFalse Tests
// ============================================
VAR _AssertFalse_Pass = PQL.Assert.ShouldBeFalse("ShouldBeFalse: FALSE condition should pass", FALSE)
VAR _AssertFalse_Fail = PQL.Assert.ShouldBeFalse("ShouldBeFalse: TRUE condition should fail", TRUE)
VAR _AssertFalse_Expression = PQL.Assert.ShouldBeFalse("ShouldBeFalse: Expression 1=2 should pass", 1 = 2)
VAR _AssertFalse_ComplexExpr = PQL.Assert.ShouldBeFalse("ShouldBeFalse: Complex expression should pass", 5 < 3 || 10 > 20)

// ============================================
// PQL.Assert.ShouldNotBeNull Tests
// ============================================
VAR _AssertNotNull_Pass_Int = PQL.Assert.ShouldNotBeNull("ShouldNotBeNull: Integer value should pass", 42)
VAR _AssertNotNull_Pass_Str = PQL.Assert.ShouldNotBeNull("ShouldNotBeNull: String value should pass", "Hello")
VAR _AssertNotNull_Pass_Zero = PQL.Assert.ShouldNotBeNull("ShouldNotBeNull: Zero should pass", 0)
VAR _AssertNotNull_Pass_EmptyStr = PQL.Assert.ShouldNotBeNull("ShouldNotBeNull: Empty string should pass", "")
VAR _AssertNotNull_Fail = PQL.Assert.ShouldNotBeNull("ShouldNotBeNull: BLANK should fail", BLANK())
VAR _AssertNotNull_Pass_Expr = PQL.Assert.ShouldNotBeNull("ShouldNotBeNull: DISTINCTCOUNTNOBLANK expression should pass", DISTINCTCOUNTNOBLANK('TestData'[ID]))

// ============================================
// PQL.Assert.Col.ShouldNotBeNull Tests
// ============================================
VAR _AssertColumnNotNull_Pass = PQL.Assert.Col.ShouldNotBeNull("Col.ShouldNotBeNull: ID has values", 'TestData'[ID])
VAR _AssertColumnNotNull_Pass_DateDim = PQL.Assert.Col.ShouldNotBeNull("Col.ShouldNotBeNull: ID has values", 'TestData'[ID])

// ============================================
// PQL.Assert.ShouldBeNull Tests
// ============================================
VAR _AssertNull_Pass = PQL.Assert.ShouldBeNull("ShouldBeNull: BLANK should pass", BLANK())
VAR _AssertNull_Fail_Int = PQL.Assert.ShouldBeNull("ShouldBeNull: Integer value should fail", 42)
VAR _AssertNull_Fail_Str = PQL.Assert.ShouldBeNull("ShouldBeNull: String value should fail", "Hello")
VAR _AssertNull_Fail_Zero = PQL.Assert.ShouldBeNull("ShouldBeNull: Zero should fail", 0)

// ============================================
// PQL.Assert.ShouldEqual Tests
// ============================================
VAR _AssertEquals_Pass_Int = PQL.Assert.ShouldEqual("ShouldEqual: Integers 10=10 should pass", 10, 10)
VAR _AssertEquals_Pass_Str = PQL.Assert.ShouldEqual("ShouldEqual: Strings should pass", "Hello", "Hello")
VAR _AssertEquals_Pass_Decimal = PQL.Assert.ShouldEqual("ShouldEqual: Decimals should pass", 3.14, 3.14)
VAR _AssertEquals_Fail_Int = PQL.Assert.ShouldEqual("ShouldEqual: Integers 10=20 should fail", 10, 20)
VAR _AssertEquals_Fail_Str = PQL.Assert.ShouldEqual("ShouldEqual: Different strings should fail", "Hello", "World")
VAR _AssertEquals_Pass_Bool = PQL.Assert.ShouldEqual("ShouldEqual: Booleans should pass", TRUE, TRUE)

// ============================================
// PQL.Assert.ShouldNotEqual Tests
// ============================================
VAR _AssertNotEquals_Pass = PQL.Assert.ShouldNotEqual("ShouldNotEqual: 10<>20 should pass", 10, 20)
VAR _AssertNotEquals_Pass_Str = PQL.Assert.ShouldNotEqual("ShouldNotEqual: Different strings should pass", "Hello", "World")
VAR _AssertNotEquals_Fail = PQL.Assert.ShouldNotEqual("ShouldNotEqual: 10<>10 should fail", 10, 10)
VAR _AssertNotEquals_Fail_Str = PQL.Assert.ShouldNotEqual("ShouldNotEqual: Same strings should fail", "Hello", "Hello")

// ============================================
// PQL.Assert.ShouldBeGreaterThan Tests
// ============================================
VAR _AssertGreaterThan_Pass = PQL.Assert.ShouldBeGreaterThan("ShouldBeGreaterThan: 15>10 should pass", 10, 15)
VAR _AssertGreaterThan_Fail_Less = PQL.Assert.ShouldBeGreaterThan("ShouldBeGreaterThan: 5>10 should fail", 10, 5)
VAR _AssertGreaterThan_Fail_Equal = PQL.Assert.ShouldBeGreaterThan("ShouldBeGreaterThan: 10>10 should fail", 10, 10)
VAR _AssertGreaterThan_Pass_Neg = PQL.Assert.ShouldBeGreaterThan("ShouldBeGreaterThan: -5>-10 should pass", -10, -5)
VAR _AssertGreaterThan_Pass_Decimal = PQL.Assert.ShouldBeGreaterThan("ShouldBeGreaterThan: 3.15>3.14 should pass", 3.14, 3.15)

// ============================================
// PQL.Assert.ShouldBeLessThan Tests
// ============================================
VAR _AssertLessThan_Pass = PQL.Assert.ShouldBeLessThan("ShouldBeLessThan: 5<10 should pass", 10, 5)
VAR _AssertLessThan_Fail_Greater = PQL.Assert.ShouldBeLessThan("ShouldBeLessThan: 15<10 should fail", 10, 15)
VAR _AssertLessThan_Fail_Equal = PQL.Assert.ShouldBeLessThan("ShouldBeLessThan: 10<10 should fail", 10, 10)
VAR _AssertLessThan_Pass_Neg = PQL.Assert.ShouldBeLessThan("ShouldBeLessThan: -10<-5 should pass", -5, -10)
VAR _AssertLessThan_Pass_Decimal = PQL.Assert.ShouldBeLessThan("ShouldBeLessThan: 3.13<3.14 should pass", 3.14, 3.13)

// ============================================
// PQL.Assert.ShouldBeBetween Tests
// ============================================
VAR _AssertBetween_Pass_Middle = PQL.Assert.ShouldBeBetween("ShouldBeBetween: 15 in [10,20] should pass", 10, 20, 15)
VAR _AssertBetween_Pass_Lower = PQL.Assert.ShouldBeBetween("ShouldBeBetween: 10 in [10,20] should pass (inclusive)", 10, 20, 10)
VAR _AssertBetween_Pass_Upper = PQL.Assert.ShouldBeBetween("ShouldBeBetween: 20 in [10,20] should pass (inclusive)", 10, 20, 20)
VAR _AssertBetween_Fail_Below = PQL.Assert.ShouldBeBetween("ShouldBeBetween: 5 in [10,20] should fail", 10, 20, 5)
VAR _AssertBetween_Fail_Above = PQL.Assert.ShouldBeBetween("ShouldBeBetween: 25 in [10,20] should fail", 10, 20, 25)
VAR _AssertBetween_Pass_Neg = PQL.Assert.ShouldBeBetween("ShouldBeBetween: -5 in [-10,0] should pass", -10, 0, -5)

// ============================================
// PQL.Assert.Tbl.ShouldHaveMoreRowsThan Tests
// ============================================
VAR _AssertRowCount_Pass = PQL.Assert.Tbl.ShouldHaveMoreRowsThan("Table.ShouldHaveMoreRowsThan: Table with 3 rows > 0 should pass", 0, _TestTableWithRows)
VAR _AssertRowCount_Pass_Exact = PQL.Assert.Tbl.ShouldHaveMoreRowsThan("Table.ShouldHaveMoreRowsThan: Table with 3 rows > 2 should pass", 2, _TestTableWithRows)
VAR _AssertRowCount_Fail_Equal = PQL.Assert.Tbl.ShouldHaveMoreRowsThan("Table.ShouldHaveMoreRowsThan: Table with 3 rows > 3 should fail", 3, _TestTableWithRows)
VAR _AssertRowCount_Fail_Empty = PQL.Assert.Tbl.ShouldHaveMoreRowsThan("Table.ShouldHaveMoreRowsThan: Empty table > 0 should fail", 0, _EmptyTable)

// ============================================
// PQL.Assert.Tbl.ShouldExist Tests
// ============================================
VAR _AssertTableExists_Pass = PQL.Assert.Tbl.ShouldExist("Table.ShouldExist: DataTypes table should exist", "DataTypes")
VAR _AssertTableExists_Pass_DateDim = PQL.Assert.Tbl.ShouldExist("Table.ShouldExist: DateDim table should exist", "DateDim")
VAR _AssertTableExists_Fail = PQL.Assert.Tbl.ShouldExist("Table.ShouldExist: NonExistentTable should fail", "NonExistentTable")

// ============================================
// PQL.Assert.Col.ShouldExist Tests
// ============================================
VAR _AssertColumnExists_Pass = PQL.Assert.Col.ShouldExist("Col.ShouldExist: DataTypes[Text] should exist", "DataTypes", "Text")
VAR _AssertColumnExists_Pass_Int = PQL.Assert.Col.ShouldExist("Col.ShouldExist: DataTypes[Whole Number] should exist", "DataTypes", "Whole Number")
VAR _AssertColumnExists_Fail_Col = PQL.Assert.Col.ShouldExist("Col.ShouldExist: DataTypes[FakeColumn] should fail", "DataTypes", "FakeColumn")
VAR _AssertColumnExists_Fail_Table = PQL.Assert.Col.ShouldExist("Col.ShouldExist: FakeTable[Col] should fail", "FakeTable", "Col")

// ============================================
// PQL.Assert.Relationship.ShouldExist Tests
// ============================================
VAR _AssertRelExists_Pass = PQL.Assert.Relationship.ShouldExist("Relationship.ShouldExist: MarvelFact->DateDim should exist", "MarvelFact", "DateID", "DateDim", "DateID")
VAR _AssertRelExists_Pass_Eye = PQL.Assert.Relationship.ShouldExist("Relationship.ShouldExist: MarvelFact->EyeColorDim should exist", "MarvelFact", "EyeID", "EyeColorDim", "EyeID")
VAR _AssertRelExists_Fail = PQL.Assert.Relationship.ShouldExist("Relationship.ShouldExist: Fake relationship should fail", "FakeFrom", "Col", "FakeTo", "Col")

// ============================================
// Combine All Test Results
// ============================================
VAR _AllTests = UNION(
    // PQL.Assert.ShouldBeTrue
    _AssertTrue_Pass,
    _AssertTrue_Fail,
    _AssertTrue_Expression,
    _AssertTrue_ComplexExpr,
    
    // PQL.Assert.ShouldBeFalse
    _AssertFalse_Pass,
    _AssertFalse_Fail,
    _AssertFalse_Expression,
    _AssertFalse_ComplexExpr,
    
    // PQL.Assert.ShouldNotBeNull
    _AssertNotNull_Pass_Int,
    _AssertNotNull_Pass_Str,
    _AssertNotNull_Pass_Zero,
    _AssertNotNull_Pass_EmptyStr,
    _AssertNotNull_Fail,
    _AssertNotNull_Pass_Expr,
    
    // PQL.Assert.Col.ShouldNotBeNull
    _AssertColumnNotNull_Pass,
    _AssertColumnNotNull_Pass_DateDim,
    
    // PQL.Assert.ShouldBeNull
    _AssertNull_Pass,
    _AssertNull_Fail_Int,
    _AssertNull_Fail_Str,
    _AssertNull_Fail_Zero,
    
    // PQL.Assert.ShouldEqual
    _AssertEquals_Pass_Int,
    _AssertEquals_Pass_Str,
    _AssertEquals_Pass_Decimal,
    _AssertEquals_Fail_Int,
    _AssertEquals_Fail_Str,
    _AssertEquals_Pass_Bool,
    
    // PQL.Assert.ShouldNotEqual
    _AssertNotEquals_Pass,
    _AssertNotEquals_Pass_Str,
    _AssertNotEquals_Fail,
    _AssertNotEquals_Fail_Str,
    
    // PQL.Assert.ShouldBeGreaterThan
    _AssertGreaterThan_Pass,
    _AssertGreaterThan_Fail_Less,
    _AssertGreaterThan_Fail_Equal,
    _AssertGreaterThan_Pass_Neg,
    _AssertGreaterThan_Pass_Decimal,
    
    // PQL.Assert.ShouldBeLessThan
    _AssertLessThan_Pass,
    _AssertLessThan_Fail_Greater,
    _AssertLessThan_Fail_Equal,
    _AssertLessThan_Pass_Neg,
    _AssertLessThan_Pass_Decimal,
    
    // PQL.Assert.ShouldBeBetween
    _AssertBetween_Pass_Middle,
    _AssertBetween_Pass_Lower,
    _AssertBetween_Pass_Upper,
    _AssertBetween_Fail_Below,
    _AssertBetween_Fail_Above,
    _AssertBetween_Pass_Neg,
    
    // PQL.Assert.Tbl.ShouldHaveMoreRowsThan
    _AssertRowCount_Pass,
    _AssertRowCount_Pass_Exact,
    _AssertRowCount_Fail_Equal,
    _AssertRowCount_Fail_Empty,
    
    // PQL.Assert.Tbl.ShouldExist
    _AssertTableExists_Pass,
    _AssertTableExists_Pass_DateDim,
    _AssertTableExists_Fail,
    
    // PQL.Assert.Col.ShouldExist
    _AssertColumnExists_Pass,
    _AssertColumnExists_Pass_Int,
    _AssertColumnExists_Fail_Col,
    _AssertColumnExists_Fail_Table,
    
    // PQL.Assert.Relationship.ShouldExist
    _AssertRelExists_Pass,
    _AssertRelExists_Pass_Eye,
    _AssertRelExists_Fail
)

// Output test results
EVALUATE _AllTests
ORDER BY [TestName]